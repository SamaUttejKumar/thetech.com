!function(){CKEDITOR.plugins.add("mathjax",{lang:"en",requires:"widget,dialog",icons:"mathjax",hidpi:!0,init:function(e){var t=e.config.mathJaxClass||"math-tex";e.config.mathJaxLib||CKEDITOR.error("mathjax-no-config"),e.widgets.add("mathjax",{inline:!0,dialog:"mathjax",button:e.lang.mathjax.button,mask:!0,allowedContent:"span(!"+t+")",styleToAllowedContentRules:function(e){return(e=e.getClassesArray())?(e.push("!"+t),"span("+e.join(",")+")"):null},pathName:e.lang.mathjax.pathName,template:'<span class="'+t+'" style="display:inline-block" data-cke-survive=1></span>',parts:{span:"span"},defaults:{math:"\\(x = {-b \\pm \\sqrt{b^2-4ac} \\over 2a}\\)"},init:function(){var t=this.parts.span.getChild(0);t&&t.type==CKEDITOR.NODE_ELEMENT&&t.is("iframe")||(t=new CKEDITOR.dom.element("iframe"),t.setAttributes({style:"border:0;width:0;height:0",scrolling:"no",frameborder:0,allowTransparency:!0,src:CKEDITOR.plugins.mathjax.fixSrc}),this.parts.span.append(t)),this.once("ready",function(){CKEDITOR.env.ie&&t.setAttribute("src",CKEDITOR.plugins.mathjax.fixSrc),this.frameWrapper=new CKEDITOR.plugins.mathjax.frameWrapper(t,e),this.frameWrapper.setValue(this.data.math)})},data:function(){this.frameWrapper&&this.frameWrapper.setValue(this.data.math)},upcast:function(e,n){if("span"==e.name&&e.hasClass(t)&&!(1<e.children.length||e.children[0].type!=CKEDITOR.NODE_TEXT)){n.math=CKEDITOR.tools.htmlDecode(e.children[0].value);var i=e.attributes;return i.style=i.style?i.style+";display:inline-block":"display:inline-block",i["data-cke-survive"]=1,e.children[0].remove(),e}},downcast:function(e){e.children[0].replaceWith(new CKEDITOR.htmlParser.text(CKEDITOR.tools.htmlEncode(this.data.math)));var t=e.attributes;return t.style=t.style.replace(/display:\s?inline-block;?\s?/,""),""===t.style&&delete t.style,e}}),CKEDITOR.dialog.add("mathjax",this.path+"dialogs/mathjax.js"),e.on("contentPreview",function(t){t.data.dataValue=t.data.dataValue.replace(/<\/head>/,'<script src="'+CKEDITOR.getUrl(e.config.mathJaxLib)+'"></script></head>')}),e.on("paste",function(e){e.data.dataValue=e.data.dataValue.replace(new RegExp("<span[^>]*?"+t+".*?</span>","ig"),function(e){return e.replace(/(<iframe.*?\/iframe>)/i,"")})})}}),CKEDITOR.plugins.mathjax={},CKEDITOR.plugins.mathjax.fixSrc=CKEDITOR.env.gecko?"javascript:true":CKEDITOR.env.ie?"javascript:void((function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();document.close();")+"})())":"javascript:void(0)",CKEDITOR.plugins.mathjax.loadingIcon=CKEDITOR.plugins.get("mathjax").path+"images/loader.gif",CKEDITOR.plugins.mathjax.copyStyles=function(e,t){for(var n="color font-family font-style font-weight font-variant font-size".split(" "),i=0;i<n.length;i++){var a=n[i],o=e.getComputedStyle(a);o&&t.setStyle(a,o)}},CKEDITOR.plugins.mathjax.trim=function(e){var t=e.indexOf("\\(")+2,n=e.lastIndexOf("\\)");return e.substring(t,n)},CKEDITOR.plugins.mathjax.frameWrapper=CKEDITOR.env.ie&&8==CKEDITOR.env.version?function(e,t){return e.getFrameDocument().write('<!DOCTYPE html><html><head><meta charset="utf-8"></head><body style="padding:0;margin:0;background:transparent;overflow:hidden"><span style="white-space:nowrap;" id="tex"></span></body></html>'),{setValue:function(n){var i=e.getFrameDocument(),a=i.getById("tex");a.setHtml(CKEDITOR.plugins.mathjax.trim(CKEDITOR.tools.htmlEncode(n))),CKEDITOR.plugins.mathjax.copyStyles(e,a),t.fire("lockSnapshot"),e.setStyles({width:Math.min(250,a.$.offsetWidth)+"px",height:i.$.body.offsetHeight+"px",display:"inline","vertical-align":"middle"}),t.fire("unlockSnapshot")}}}:function(e,t){function n(){l=e.getFrameDocument(),l.getById("preview")||(CKEDITOR.env.ie&&e.removeAttribute("src"),l.write('<!DOCTYPE html><html><head><meta charset="utf-8"><script type="text/x-mathjax-config">MathJax.Hub.Config( {showMathMenu: false,messageStyle: "none"} );function getCKE() {if ( typeof window.parent.CKEDITOR == \'object\' ) {return window.parent.CKEDITOR;} else {return window.parent.parent.CKEDITOR;}}function update() {MathJax.Hub.Queue([ \'Typeset\', MathJax.Hub, this.buffer ],function() {getCKE().tools.callFunction( '+h+" );});}MathJax.Hub.Queue( function() {getCKE().tools.callFunction("+d+');} );</script><script src="'+t.config.mathJaxLib+'"></script></head><body style="padding:0;margin:0;background:transparent;overflow:hidden"><span id="preview"></span><span id="buffer" style="display:none"></span></body></html>'))}function i(){u=!0,r=s,t.fire("lockSnapshot"),a.setHtml(r),o.setHtml("<img src="+CKEDITOR.plugins.mathjax.loadingIcon+" alt="+t.lang.mathjax.loading+">"),e.setStyles({height:"16px",width:"16px",display:"inline","vertical-align":"middle"}),t.fire("unlockSnapshot"),l.getWindow().$.update(r)}var a,o,r,s,l=e.getFrameDocument(),c=!1,u=!1,d=CKEDITOR.tools.addFunction(function(){o=l.getById("preview"),a=l.getById("buffer"),c=!0,s&&i(),CKEDITOR.fire("mathJaxLoaded",e)}),h=CKEDITOR.tools.addFunction(function(){CKEDITOR.plugins.mathjax.copyStyles(e,o),o.setHtml(a.getHtml()),t.fire("lockSnapshot"),e.setStyles({height:0,width:0});var n=Math.max(l.$.body.offsetHeight,l.$.documentElement.offsetHeight),c=Math.max(o.$.offsetWidth,l.$.body.scrollWidth);e.setStyles({height:n+"px",width:c+"px"}),t.fire("unlockSnapshot"),CKEDITOR.fire("mathJaxUpdateDone",e),r!=s?i():u=!1});return e.on("load",n),n(),{setValue:function(e){s=CKEDITOR.tools.htmlEncode(e),c&&!u&&i()}}}}();