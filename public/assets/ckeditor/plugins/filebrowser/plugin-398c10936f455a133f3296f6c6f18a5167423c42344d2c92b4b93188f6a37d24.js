!function(){function e(e,t){var n=[];if(!t)return e;for(var o in t)n.push(o+"="+encodeURIComponent(t[o]));return e+(-1!=e.indexOf("?")?"&":"?")+n.join("&")}function t(e){return e+="",e.charAt(0).toUpperCase()+e.substr(1)}function n(){var n=this.getDialog(),o=n.getParentEditor();o._.filebrowserSe=this;var a=o.config["filebrowser"+t(n.getName())+"WindowWidth"]||o.config.filebrowserWindowWidth||"80%",n=o.config["filebrowser"+t(n.getName())+"WindowHeight"]||o.config.filebrowserWindowHeight||"70%",i=this.filebrowser.params||{};i.CKEditor=o.name,i.CKEditorFuncNum=o._.filebrowserFn,i.langCode||(i.langCode=o.langCode),i=e(this.filebrowser.url,i),o.popup(i,a,n,o.config.filebrowserWindowFeatures||o.config.fileBrowserWindowFeatures)}function o(){var e=this.getDialog();return e.getParentEditor()._.filebrowserSe=this,!(!e.getContentElement(this["for"][0],this["for"][1]).getInputElement().$.value||!e.getContentElement(this["for"][0],this["for"][1]).getAction())}function a(t,n,o){var a=o.params||{};a.CKEditor=t.name,a.CKEditorFuncNum=t._.filebrowserFn,a.langCode||(a.langCode=t.langCode),n.action=e(o.url,a),n.filebrowser=o}function i(e,r,s,l){if(l&&l.length)for(var c,u=l.length;u--;)if(c=l[u],"hbox"!=c.type&&"vbox"!=c.type&&"fieldset"!=c.type||i(e,r,s,c.children),c.filebrowser)if("string"==typeof c.filebrowser&&(c.filebrowser={action:"fileButton"==c.type?"QuickUpload":"Browse",target:c.filebrowser}),"Browse"==c.filebrowser.action){var d=c.filebrowser.url;void 0===d&&(d=e.config["filebrowser"+t(r)+"BrowseUrl"],void 0===d&&(d=e.config.filebrowserBrowseUrl)),d&&(c.onClick=n,c.filebrowser.url=d,c.hidden=!1)}else if("QuickUpload"==c.filebrowser.action&&c["for"]&&(d=c.filebrowser.url,void 0===d&&(d=e.config["filebrowser"+t(r)+"UploadUrl"],void 0===d&&(d=e.config.filebrowserUploadUrl)),d)){var p=c.onClick;c.onClick=function(e){var t=e.sender;return(!p||!1!==p.call(t,e))&&(!!o.call(t,e)&&(e=t.getDialog().getContentElement(this["for"][0],this["for"][1]).getInputElement(),(t=new CKEDITOR.dom.element(e.$.form))&&((e=t.$.elements.ckCsrfToken)?e=new CKEDITOR.dom.element(e):(e=new CKEDITOR.dom.element("input"),e.setAttributes({name:"ckCsrfToken",type:"hidden"}),t.append(e)),e.setAttribute("value",CKEDITOR.tools.getCsrfToken())),!0))},c.filebrowser.url=d,c.hidden=!1,a(e,s.getContents(c["for"][0]).get(c["for"][1]),c.filebrowser)}}function r(e,t,n){if(-1!==n.indexOf(";")){n=n.split(";");for(var o=0;o<n.length;o++)if(r(e,t,n[o]))return!0;return!1}return(e=e.getContents(t).get(n).filebrowser)&&e.url}function s(e,t){var n=this._.filebrowserSe.getDialog(),o=this._.filebrowserSe["for"],a=this._.filebrowserSe.filebrowser.onSelect;o&&n.getContentElement(o[0],o[1]).reset(),"function"==typeof t&&!1===t.call(this._.filebrowserSe)||a&&!1===a.call(this._.filebrowserSe,e,t)||("string"==typeof t&&t&&alert(t),e&&(o=this._.filebrowserSe,n=o.getDialog(),o=o.filebrowser.target||null)&&(o=o.split(":"),(a=n.getContentElement(o[0],o[1]))&&(a.setValue(e),n.selectPage(o[0]))))}CKEDITOR.plugins.add("filebrowser",{requires:"popup",init:function(e){e._.filebrowserFn=CKEDITOR.tools.addFunction(s,e),e.on("destroy",function(){CKEDITOR.tools.removeFunction(this._.filebrowserFn)})}}),CKEDITOR.on("dialogDefinition",function(e){if(e.editor.plugins.filebrowser)for(var t,n=e.data.definition,o=0;o<n.contents.length;++o)(t=n.contents[o])&&(i(e.editor,e.data.name,n,t.elements),t.hidden&&t.filebrowser&&(t.hidden=!r(n,t.id,t.filebrowser)))})}();