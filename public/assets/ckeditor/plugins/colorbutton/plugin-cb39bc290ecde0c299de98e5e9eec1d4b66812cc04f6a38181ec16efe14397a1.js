CKEDITOR.plugins.add("colorbutton",{requires:"panelbutton,floatpanel",lang:"en",icons:"bgcolor,textcolor",hidpi:!0,init:function(e){function t(t,a,r,s){var l=new CKEDITOR.style(o["colorButton_"+a+"Style"]),c=CKEDITOR.tools.getNextId()+"_colorBox";e.ui.add(t,CKEDITOR.UI_PANELBUTTON,{label:r,title:r,modes:{wysiwyg:1},editorFocus:0,toolbar:"colors,"+s,allowedContent:l,requiredContent:l,panel:{css:CKEDITOR.skin.getPath("editor"),attributes:{role:"listbox","aria-label":i.panelTitle}},onBlock:function(t,o){o.autoSize=!0,o.element.addClass("cke_colorblock"),o.element.setHtml(n(t,a,c)),o.element.getDocument().getBody().setStyle("overflow","hidden"),CKEDITOR.ui.fire("ready",this);var i=o.keys,r="rtl"==e.lang.dir;i[r?37:39]="next",i[40]="next",i[9]="next",i[r?39:37]="prev",i[38]="prev",i[CKEDITOR.SHIFT+9]="prev",i[32]="click"},refresh:function(){e.activeFilter.check(l)||this.setState(CKEDITOR.TRISTATE_DISABLED)},onOpen:function(){var t,n=e.getSelection(),n=n&&n.getStartElement(),n=e.elementPath(n);if(n){n=n.block||n.blockLimit||e.document.getBody();do t=n&&n.getComputedStyle("back"==a?"background-color":"color")||"transparent";while("back"==a&&"transparent"==t&&n&&(n=n.getParent()));return t&&"transparent"!=t||(t="#ffffff"),this._.panel._.iframe.getFrameDocument().getById(c).setStyle("background-color",t),t}}})}function n(t,n,r){var s=[],l=o.colorButton_colors.split(","),c=e.plugins.colordialog&&!1!==o.colorButton_enableMore,u=l.length+(c?2:1),d=CKEDITOR.tools.addFunction(function(n,i){function r(e){this.removeListener("ok",r),this.removeListener("cancel",r),"ok"==e.name&&s(this.getContentElement("picker","selectedColor").getValue(),i)}var s=arguments.callee;if("?"==n)e.openDialog("colordialog",function(){this.on("ok",r),this.on("cancel",r)});else{if(e.focus(),t.hide(),e.fire("saveSnapshot"),e.removeStyle(new CKEDITOR.style(o["colorButton_"+i+"Style"],{color:"inherit"})),n){var l=o["colorButton_"+i+"Style"];l.childRule="back"==i?function(e){return a(e)}:function(e){return!(e.is("a")||e.getElementsByTag("a").count())||a(e)},e.applyStyle(new CKEDITOR.style(l,{color:n}))}e.fire("saveSnapshot")}});for(s.push('<a class="cke_colorauto" _cke_focus=1 hidefocus=true title="',i.auto,'" onclick="CKEDITOR.tools.callFunction(',d,",null,'",n,"');return false;\" href=\"javascript:void('",i.auto,'\')" role="option" aria-posinset="1" aria-setsize="',u,'"><table role="presentation" cellspacing=0 cellpadding=0 width="100%"><tr><td><span class="cke_colorbox" id="',r,'"></span></td><td colspan=7 align=center>',i.auto,'</td></tr></table></a><table role="presentation" cellspacing=0 cellpadding=0 width="100%">'),r=0;r<l.length;r++){0===r%8&&s.push("</tr><tr>");var p=l[r].split("/"),h=p[0],m=p[1]||h;p[1]||(h="#"+h.replace(/^(.)(.)(.)$/,"$1$1$2$2$3$3")),p=e.lang.colorbutton.colors[m]||m,s.push('<td><a class="cke_colorbox" _cke_focus=1 hidefocus=true title="',p,'" onclick="CKEDITOR.tools.callFunction(',d,",'",h,"','",n,"'); return false;\" href=\"javascript:void('",p,'\')" role="option" aria-posinset="',r+2,'" aria-setsize="',u,'"><span class="cke_colorbox" style="background-color:#',m,'"></span></a></td>')}return c&&s.push('</tr><tr><td colspan=8 align=center><a class="cke_colormore" _cke_focus=1 hidefocus=true title="',i.more,'" onclick="CKEDITOR.tools.callFunction(',d,",'?','",n,"');return false;\" href=\"javascript:void('",i.more,"')\"",' role="option" aria-posinset="',u,'" aria-setsize="',u,'">',i.more,"</a></td>"),s.push("</tr></table>"),s.join("")}function a(e){return"false"==e.getAttribute("contentEditable")||e.getAttribute("data-nostyle")}var o=e.config,i=e.lang.colorbutton;CKEDITOR.env.hc||(t("TextColor","fore",i.textColorTitle,10),t("BGColor","back",i.bgColorTitle,20))}}),CKEDITOR.config.colorButton_colors="000,800000,8B4513,2F4F4F,008080,000080,4B0082,696969,B22222,A52A2A,DAA520,006400,40E0D0,0000CD,800080,808080,F00,FF8C00,FFD700,008000,0FF,00F,EE82EE,A9A9A9,FFA07A,FFA500,FFFF00,00FF00,AFEEEE,ADD8E6,DDA0DD,D3D3D3,FFF0F5,FAEBD7,FFFFE0,F0FFF0,F0FFFF,F0F8FF,E6E6FA,FFF",CKEDITOR.config.colorButton_foreStyle={element:"span",styles:{color:"#(color)"},overrides:[{element:"font",attributes:{color:null}}]},CKEDITOR.config.colorButton_backStyle={element:"span",styles:{"background-color":"#(color)"}};