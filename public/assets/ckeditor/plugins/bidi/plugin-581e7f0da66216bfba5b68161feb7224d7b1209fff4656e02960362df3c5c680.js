!function(){function e(e,t,n,o){if(!e.isReadOnly()&&!e.equals(n.editable())){CKEDITOR.dom.element.setMarker(o,e,"bidi_processed",1),o=e;for(var a=n.editable();(o=o.getParent())&&!o.equals(a);)if(o.getCustomData("bidi_processed"))return e.removeStyle("direction"),void e.removeAttribute("dir");o="useComputedState"in n.config?n.config.useComputedState:1,(o?e.getComputedStyle("direction"):e.getStyle("direction")||e.hasAttribute("dir"))!=t&&(e.removeStyle("direction"),o?(e.removeAttribute("dir"),t!=e.getComputedStyle("direction")&&e.setAttribute("dir",t)):e.setAttribute("dir",t),n.forceNextSelectionCheck())}}function t(e,t,n){var o=e.getCommonAncestor(!1,!0);if(e=e.clone(),e.enlarge(n==CKEDITOR.ENTER_BR?CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS:CKEDITOR.ENLARGE_BLOCK_CONTENTS),e.checkBoundaryOfElement(o,CKEDITOR.START)&&e.checkBoundaryOfElement(o,CKEDITOR.END)){for(var a;o&&o.type==CKEDITOR.NODE_ELEMENT&&(a=o.getParent())&&1==a.getChildCount()&&!(o.getName()in t);)o=a;return o.type==CKEDITOR.NODE_ELEMENT&&o.getName()in t&&o}}function n(n){return{context:"p",allowedContent:{"h1 h2 h3 h4 h5 h6 table ul ol blockquote div tr p div li td":{propertiesOnly:!0,attributes:"dir"}},requiredContent:"p[dir]",refresh:function(e,t){var n,o=e.config.useComputedState,o=void 0===o||o;if(!o){n=t.lastElement;for(var a=e.editable();n&&!(n.getName()in r||n.equals(a));){var i=n.getParent();if(!i)break;n=i}}n=n||t.block||t.blockLimit,n.equals(e.editable())&&(a=e.getSelection().getRanges()[0].getEnclosedNode())&&a.type==CKEDITOR.NODE_ELEMENT&&(n=a),n&&(o=o?n.getComputedStyle("direction"):n.getStyle("direction")||n.getAttribute("dir"),e.getCommand("bidirtl").setState("rtl"==o?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF),e.getCommand("bidiltr").setState("ltr"==o?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF)),o=(t.block||t.blockLimit||e.editable()).getDirection(1),o!=(e._.selDir||e.lang.dir)&&(e._.selDir=o,e.fire("contentDirChanged",o))},exec:function(o){var r=o.getSelection(),s=o.config.enterMode,l=r.getRanges();if(l&&l.length){for(var u,c={},d=r.createBookmarks(),l=l.createIterator(),p=0;u=l.getNextRange(1);){var h=u.getEnclosedNode();h&&(!h||h.type==CKEDITOR.NODE_ELEMENT&&h.getName()in i)||(h=t(u,a,s)),h&&e(h,n,o,c);var m=new CKEDITOR.dom.walker(u),f=d[p].startNode,g=d[p++].endNode;m.evaluator=function(e){var t,n=s==CKEDITOR.ENTER_P?"p":"div";return(t=!!e&&e.type==CKEDITOR.NODE_ELEMENT&&e.getName()in a)&&((n=e.is(n))&&(n=!!(n=e.getParent())&&n.type==CKEDITOR.NODE_ELEMENT),t=!(n&&e.getParent().is("blockquote"))),!!(t&&e.getPosition(f)&CKEDITOR.POSITION_FOLLOWING&&(e.getPosition(g)&CKEDITOR.POSITION_PRECEDING+CKEDITOR.POSITION_CONTAINS)==CKEDITOR.POSITION_PRECEDING)};for(;h=m.next();)e(h,n,o,c);for(u=u.createIterator(),u.enlargeBr=s!=CKEDITOR.ENTER_BR;h=u.getNextParagraph(s==CKEDITOR.ENTER_P?"p":"div");)e(h,n,o,c)}CKEDITOR.dom.element.clearAllMarkers(c),o.forceNextSelectionCheck(),r.selectBookmarks(d),o.focus()}}}}function o(e){var t=e==s.setAttribute,n=e==s.removeAttribute,o=/\bdirection\s*:\s*(.*?)\s*(:?$|;)/;return function(a,i){if(!this.isReadOnly()){var r;if(r=a==(t||n?"dir":"direction")||"style"==a&&(n||o.test(i))){e:{r=this;for(var s=r.getDocument().getBody().getParent();r;){if(r.equals(s)){r=!1;break e}r=r.getParent()}r=!0}r=!r}if(r&&(r=this.getDirection(1),s=e.apply(this,arguments),r!=this.getDirection(1)))return this.getDocument().fire("dirChanged",this),s}return e.apply(this,arguments)}}var a={table:1,ul:1,ol:1,blockquote:1,div:1},i={},r={};CKEDITOR.tools.extend(i,a,{tr:1,p:1,div:1,li:1}),CKEDITOR.tools.extend(r,i,{td:1}),CKEDITOR.plugins.add("bidi",{lang:"en",icons:"bidiltr,bidirtl",hidpi:!0,init:function(e){function t(t,n,o,a,i){e.addCommand(o,new CKEDITOR.command(e,a)),e.ui.addButton&&e.ui.addButton(t,{label:n,command:o,toolbar:"bidi,"+i})}if(!e.blockless){var o=e.lang.bidi;t("BidiLtr",o.ltr,"bidiltr",n("ltr"),10),t("BidiRtl",o.rtl,"bidirtl",n("rtl"),20),e.on("contentDom",function(){e.document.on("dirChanged",function(t){e.fire("dirChanged",{node:t.data,dir:t.data.getDirection(1)})})}),e.on("contentDirChanged",function(t){t=(e.lang.dir!=t.data?"add":"remove")+"Class";var n=e.ui.space(e.config.toolbarLocation);n&&n[t]("cke_mixed_dir_content")})}}});for(var s=CKEDITOR.dom.element.prototype,l=["setStyle","removeStyle","setAttribute","removeAttribute"],u=0;u<l.length;u++)s[l[u]]=CKEDITOR.tools.override(s[l[u]],o)}();