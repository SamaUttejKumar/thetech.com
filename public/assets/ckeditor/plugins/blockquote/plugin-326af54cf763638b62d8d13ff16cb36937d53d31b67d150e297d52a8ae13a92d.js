!function(){var e={exec:function(e){var t=e.getCommand("blockquote").state,n=e.getSelection(),o=n&&n.getRanges()[0];if(o){var a=n.createBookmarks();if(CKEDITOR.env.ie){var i,r=a[0].startNode,s=a[0].endNode;if(r&&"blockquote"==r.getParent().getName())for(i=r;i=i.getNext();)if(i.type==CKEDITOR.NODE_ELEMENT&&i.isBlockBoundary()){r.move(i,!0);break}if(s&&"blockquote"==s.getParent().getName())for(i=s;i=i.getPrevious();)if(i.type==CKEDITOR.NODE_ELEMENT&&i.isBlockBoundary()){s.move(i);break}}var l=o.createIterator();if(l.enlargeBr=e.config.enterMode!=CKEDITOR.ENTER_BR,t==CKEDITOR.TRISTATE_OFF){for(r=[];t=l.getNextParagraph();)r.push(t);for(1>r.length&&(t=e.document.createElement(e.config.enterMode==CKEDITOR.ENTER_P?"p":"div"),s=a.shift(),o.insertNode(t),t.append(new CKEDITOR.dom.text("\ufeff",e.document)),o.moveToBookmark(s),o.selectNodeContents(t),o.collapse(!0),s=o.createBookmark(),r.push(t),a.unshift(s)),i=r[0].getParent(),o=[],s=0;s<r.length;s++)t=r[s],i=i.getCommonAncestor(t.getParent());for(t={table:1,tbody:1,tr:1,ol:1,ul:1};t[i.getName()];)i=i.getParent();for(s=null;0<r.length;){for(t=r.shift();!t.getParent().equals(i);)t=t.getParent();t.equals(s)||o.push(t),s=t}for(;0<o.length;)if(t=o.shift(),"blockquote"==t.getName()){for(s=new CKEDITOR.dom.documentFragment(e.document);t.getFirst();)s.append(t.getFirst().remove()),r.push(s.getLast());s.replace(t)}else r.push(t);for(o=e.document.createElement("blockquote"),o.insertBefore(r[0]);0<r.length;)t=r.shift(),o.append(t)}else if(t==CKEDITOR.TRISTATE_ON){for(s=[],i={};t=l.getNextParagraph();){for(r=o=null;t.getParent();){if("blockquote"==t.getParent().getName()){o=t.getParent(),r=t;break}t=t.getParent()}o&&r&&!r.getCustomData("blockquote_moveout")&&(s.push(r),CKEDITOR.dom.element.setMarker(i,r,"blockquote_moveout",!0))}for(CKEDITOR.dom.element.clearAllMarkers(i),t=[],r=[],i={};0<s.length;)l=s.shift(),o=l.getParent(),l.getPrevious()?l.getNext()?(l.breakParent(l.getParent()),r.push(l.getNext())):l.remove().insertAfter(o):l.remove().insertBefore(o),o.getCustomData("blockquote_processed")||(r.push(o),CKEDITOR.dom.element.setMarker(i,o,"blockquote_processed",!0)),t.push(l);for(CKEDITOR.dom.element.clearAllMarkers(i),s=r.length-1;0<=s;s--){o=r[s];e:{i=o;for(var l=0,u=i.getChildCount(),c=void 0;l<u&&(c=i.getChild(l));l++)if(c.type==CKEDITOR.NODE_ELEMENT&&c.isBlockBoundary()){i=!1;break e}i=!0}i&&o.remove()}if(e.config.enterMode==CKEDITOR.ENTER_BR)for(o=!0;t.length;)if(l=t.shift(),"div"==l.getName()){for(s=new CKEDITOR.dom.documentFragment(e.document),!o||!l.getPrevious()||l.getPrevious().type==CKEDITOR.NODE_ELEMENT&&l.getPrevious().isBlockBoundary()||s.append(e.document.createElement("br")),o=l.getNext()&&!(l.getNext().type==CKEDITOR.NODE_ELEMENT&&l.getNext().isBlockBoundary());l.getFirst();)l.getFirst().remove().appendTo(s);o&&s.append(e.document.createElement("br")),s.replace(l),o=!1}}n.selectBookmarks(a),e.focus()}},refresh:function(e,t){this.setState(e.elementPath(t.block||t.blockLimit).contains("blockquote",1)?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF)},context:"blockquote",allowedContent:"blockquote",requiredContent:"blockquote"};CKEDITOR.plugins.add("blockquote",{lang:"en",icons:"blockquote",hidpi:!0,init:function(t){t.blockless||(t.addCommand("blockquote",e),t.ui.addButton&&t.ui.addButton("Blockquote",{label:t.lang.blockquote.toolbar,command:"blockquote",toolbar:"blocks,10"}))}})}();