!function(){function e(e,t,n){t.is&&t.getCustomData("block_processed")||(t.is&&CKEDITOR.dom.element.setMarker(n,t,"block_processed",!0),e.push(t))}function t(t,n){function o(){this.foreach(function(e){/^(?!vbox|hbox)/.test(e.type)&&(e.setup||(e.setup=function(t){e.setValue(t.getAttribute(e.id)||"",1)}),e.commit||(e.commit=function(t){var n=this.getValue();"dir"==e.id&&t.getComputedStyle("direction")==n||(n?t.setAttribute(e.id,n):t.removeAttribute(e.id))}))})}var a=function(){var e=CKEDITOR.tools.extend({},CKEDITOR.dtd.$blockLimit);return t.config.div_wrapTable&&(delete e.td,delete e.th),e}(),i=CKEDITOR.dtd.div,r={},s=[];return{title:t.lang.div.title,minWidth:400,minHeight:165,contents:[{id:"info",label:t.lang.common.generalTab,title:t.lang.common.generalTab,elements:[{type:"hbox",widths:["50%","50%"],children:[{id:"elementStyle",type:"select",style:"width: 100%;",label:t.lang.div.styleSelectLabel,"default":"",items:[[t.lang.common.notSet,""]],onChange:function(){var e=["info:elementStyle","info:class","advanced:dir","advanced:style"],n=this.getDialog(),o=n._element&&n._element.clone()||new CKEDITOR.dom.element("div",t.document);this.commit(o,!0);for(var a,e=[].concat(e),i=e.length,r=0;r<i;r++)(a=n.getContentElement.apply(n,e[r].split(":")))&&a.setup&&a.setup(o,!0)},setup:function(e){for(var n in r)r[n].checkElementRemovable(e,!0,t)&&this.setValue(n,1)},commit:function(e){var n;(n=this.getValue())?r[n].applyToObject(e,t):e.removeAttribute("style")}},{id:"class",type:"text",requiredContent:"div(cke-xyz)",label:t.lang.common.cssClass,"default":""}]}]},{id:"advanced",label:t.lang.common.advancedTab,title:t.lang.common.advancedTab,elements:[{type:"vbox",padding:1,children:[{type:"hbox",widths:["50%","50%"],children:[{type:"text",id:"id",requiredContent:"div[id]",label:t.lang.common.id,"default":""},{type:"text",id:"lang",requiredContent:"div[lang]",label:t.lang.common.langCode,"default":""}]},{type:"hbox",children:[{type:"text",id:"style",requiredContent:"div{cke-xyz}",style:"width: 100%;",label:t.lang.common.cssStyle,"default":"",commit:function(e){e.setAttribute("style",this.getValue())}}]},{type:"hbox",children:[{type:"text",id:"title",requiredContent:"div[title]",style:"width: 100%;",label:t.lang.common.advisoryTitle,"default":""}]},{type:"select",id:"dir",requiredContent:"div[dir]",style:"width: 100%;",label:t.lang.common.langDir,"default":"",items:[[t.lang.common.notSet,""],[t.lang.common.langDirLtr,"ltr"],[t.lang.common.langDirRtl,"rtl"]]}]}]}],onLoad:function(){o.call(this);var e=this,n=this.getContentElement("info","elementStyle");t.getStylesSet(function(o){var a,i;if(o)for(var s=0;s<o.length;s++)i=o[s],i.element&&"div"==i.element&&(a=i.name,r[a]=i=new CKEDITOR.style(i),t.filter.check(i)&&(n.items.push([a,a]),n.add(a,a)));n[1<n.items.length?"enable":"disable"](),setTimeout(function(){e._element&&n.setup(e._element)},0)})},onShow:function(){"editdiv"==n&&this.setupContent(this._element=CKEDITOR.plugins.div.getSurroundDiv(t))},onOk:function(){if("editdiv"==n)s=[this._element];else{var o,r,l,c=[],u={},d=[],p=t.getSelection(),h=p.getRanges(),m=p.createBookmarks();for(r=0;r<h.length;r++)for(l=h[r].createIterator();o=l.getNextParagraph();)if(o.getName()in a&&!o.isReadOnly()){var f=o.getChildren();for(o=0;o<f.count();o++)e(d,f.getItem(o),u)}else{for(;!i[o.getName()]&&!o.equals(h[r].root);)o=o.getParent();e(d,o,u)}for(CKEDITOR.dom.element.clearAllMarkers(u),h=[],r=null,l=0;l<d.length;l++)o=d[l],f=t.elementPath(o).blockLimit,f.isReadOnly()&&(f=f.getParent()),t.config.div_wrapTable&&f.is(["td","th"])&&(f=t.elementPath(f.getParent()).blockLimit),f.equals(r)||(r=f,h.push([])),h[h.length-1].push(o);for(r=0;r<h.length;r++){for(f=h[r][0],d=f.getParent(),o=1;o<h[r].length;o++)d=d.getCommonAncestor(h[r][o]);for(l=new CKEDITOR.dom.element("div",t.document),o=0;o<h[r].length;o++){for(f=h[r][o];!f.getParent().equals(d);)f=f.getParent();h[r][o]=f}for(o=0;o<h[r].length;o++)f=h[r][o],f.getCustomData&&f.getCustomData("block_processed")||(f.is&&CKEDITOR.dom.element.setMarker(u,f,"block_processed",!0),o||l.insertBefore(f),l.append(f));CKEDITOR.dom.element.clearAllMarkers(u),c.push(l)}p.selectBookmarks(m),s=c}for(c=s.length,u=0;u<c;u++)this.commitContent(s[u]),!s[u].getAttribute("style")&&s[u].removeAttribute("style");this.hide()},onHide:function(){"editdiv"==n&&this._element.removeCustomData("elementStyle"),delete this._element}}}CKEDITOR.dialog.add("creatediv",function(e){return t(e,"creatediv")}),CKEDITOR.dialog.add("editdiv",function(e){return t(e,"editdiv")})}();