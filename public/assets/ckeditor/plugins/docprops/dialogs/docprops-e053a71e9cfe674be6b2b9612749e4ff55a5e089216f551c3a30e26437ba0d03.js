CKEDITOR.dialog.add("docProps",function(e){function t(t,n){var o=function(){a(this),n(this,this._.parentDialog)},a=function(e){e.removeListener("ok",o),e.removeListener("cancel",a)},i=function(e){e.on("ok",o),e.on("cancel",a)};e.execCommand(t),e._.storedDialogs.colordialog?i(e._.storedDialogs.colordialog):CKEDITOR.on("dialogDefinition",function(e){if(e.data.name==t){var n=e.data.definition;e.removeListener(),n.onLoad=CKEDITOR.tools.override(n.onLoad,function(e){return function(){i(this),n.onLoad=e,"function"==typeof e&&e.call(this)}})}})}function n(){var e=this.getDialog().getContentElement("general",this.id+"Other");e&&("other"==this.getValue()?(e.getInputElement().removeAttribute("readOnly"),e.focus(),e.getElement().removeClass("cke_disabled")):(e.getInputElement().setAttribute("readOnly",!0),e.getElement().addClass("cke_disabled")))}function o(t,n,o){return function(a,i,r){i=c,a="undefined"!=typeof o?o:this.getValue(),!a&&t in i?i[t].remove():a&&t in i?i[t].setAttribute("content",a):a&&(i=new CKEDITOR.dom.element("meta",e.document),i.setAttribute(n?"http-equiv":"name",t),i.setAttribute("content",a),r.append(i))}}function a(e,t){return function(){var n=c,n=e in n?n[e].getAttribute("content")||"":"";return t?n:(this.setValue(n),null)}}function i(e){return function(t,n,o,a){a.removeAttribute("margin"+e),t=this.getValue(),""!==t?a.setStyle("margin-"+e,CKEDITOR.tools.cssLength(t)):a.removeStyle("margin-"+e)}}function r(e,t,n){e.removeStyle(t),e.getComputedStyle(t)!=n&&e.setStyle(t,n)}var s=e.lang.docprops,l=e.lang.common,c={},u=function(e,n,o){return{type:"hbox",padding:0,widths:["60%","40%"],children:[CKEDITOR.tools.extend({type:"text",id:e,label:s[n]},o||{},1),{type:"button",id:e+"Choose",label:s.chooseColor,className:"colorChooser",onClick:function(){var n=this;t("colordialog",function(t){var o=n.getDialog();o.getContentElement(o._.currentTabId,e).setValue(t.getContentElement("picker","selectedColor").getValue())})}}]}},d="javascript:void((function(){"+encodeURIComponent("document.open();"+(CKEDITOR.env.ie?"("+CKEDITOR.tools.fixDomain+")();":"")+'document.write( \'<html style="background-color: #ffffff; height: 100%"><head></head><body style="width: 100%; height: 100%; margin: 0px">'+s.previewHtml+"</body></html>' );document.close();")+"})())";return{title:s.title,minHeight:330,minWidth:500,onShow:function(){for(var t=e.document,n=t.getElementsByTag("html").getItem(0),o=t.getHead(),a=t.getBody(),i={},r=t.getElementsByTag("meta"),s=r.count(),l=0;l<s;l++){var u=r.getItem(l);i[u.getAttribute(u.hasAttribute("http-equiv")?"http-equiv":"name").toLowerCase()]=u}c=i,this.setupContent(t,n,o,a)},onHide:function(){c={}},onOk:function(){var t=e.document,n=t.getElementsByTag("html").getItem(0),o=t.getHead(),a=t.getBody();this.commitContent(t,n,o,a)},contents:[{id:"general",label:l.generalTab,elements:[{type:"text",id:"title",label:s.docTitle,setup:function(e){this.setValue(e.getElementsByTag("title").getItem(0).data("cke-title"))},commit:function(e,t,n,o,a){a||e.getElementsByTag("title").getItem(0).data("cke-title",this.getValue())}},{type:"hbox",children:[{type:"select",id:"dir",label:l.langDir,style:"width: 100%",items:[[l.notSet,""],[l.langDirLtr,"ltr"],[l.langDirRtl,"rtl"]],setup:function(e,t,n,o){this.setValue(o.getDirection()||"")},commit:function(e,t,n,o){(e=this.getValue())?o.setAttribute("dir",e):o.removeAttribute("dir"),o.removeStyle("direction")}},{type:"text",id:"langCode",label:l.langCode,setup:function(e,t){this.setValue(t.getAttribute("xml:lang")||t.getAttribute("lang")||"")},commit:function(e,t,n,o,a){a||((e=this.getValue())?t.setAttributes({"xml:lang":e,lang:e}):t.removeAttributes({"xml:lang":1,lang:1}))}}]},{type:"hbox",children:[{type:"select",id:"charset",label:s.charset,style:"width: 100%",items:[[l.notSet,""],[s.charsetASCII,"us-ascii"],[s.charsetCE,"iso-8859-2"],[s.charsetCT,"big5"],[s.charsetCR,"iso-8859-5"],[s.charsetGR,"iso-8859-7"],[s.charsetJP,"iso-2022-jp"],[s.charsetKR,"iso-2022-kr"],[s.charsetTR,"iso-8859-9"],[s.charsetUN,"utf-8"],[s.charsetWE,"iso-8859-1"],[s.other,"other"]],"default":"",onChange:function(){this.getDialog().selectedCharset="other"!=this.getValue()?this.getValue():"",n.call(this)},setup:function(){this.metaCharset="charset"in c;var e=a(this.metaCharset?"charset":"content-type",1,1).call(this);if(!this.metaCharset&&e.match(/charset=[^=]+$/)&&(e=e.substring(e.indexOf("=")+1)),e){if(this.setValue(e.toLowerCase()),!this.getValue()){this.setValue("other");var t=this.getDialog().getContentElement("general","charsetOther");t&&t.setValue(e)}this.getDialog().selectedCharset=e}n.call(this)},commit:function(e,t,n,a,i){i||(a=this.getValue(),i=this.getDialog().getContentElement("general","charsetOther"),"other"==a&&(a=i?i.getValue():""),a&&!this.metaCharset&&(a=(c["content-type"]?c["content-type"].getAttribute("content").split(";")[0]:"text/html")+"; charset="+a),o(this.metaCharset?"charset":"content-type",1,a).call(this,e,t,n))}},{type:"text",id:"charsetOther",label:s.charsetOther,onChange:function(){this.getDialog().selectedCharset=this.getValue()}}]},{type:"hbox",children:[{type:"select",id:"docType",label:s.docType,style:"width: 100%",items:[[l.notSet,""],["XHTML 1.1",'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">'],["XHTML 1.0 Transitional",'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">'],["XHTML 1.0 Strict",'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">'],["XHTML 1.0 Frameset",'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Frameset//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-frameset.dtd">'],["HTML 5","<!DOCTYPE html>"],["HTML 4.01 Transitional",'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">'],["HTML 4.01 Strict",'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">'],["HTML 4.01 Frameset",'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Frameset//EN" "http://www.w3.org/TR/html4/frameset.dtd">'],["HTML 3.2",'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">'],["HTML 2.0",'<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">'],[s.other,"other"]],onChange:n,setup:function(){if(e.docType&&(this.setValue(e.docType),!this.getValue())){this.setValue("other");var t=this.getDialog().getContentElement("general","docTypeOther");t&&t.setValue(e.docType)}n.call(this)},commit:function(t,n,o,a,i){i||(t=this.getValue(),n=this.getDialog().getContentElement("general","docTypeOther"),e.docType="other"==t?n?n.getValue():"":t)}},{type:"text",id:"docTypeOther",label:s.docTypeOther}]},{type:"checkbox",id:"xhtmlDec",label:s.xhtmlDec,setup:function(){this.setValue(!!e.xmlDeclaration)},commit:function(t,n,o,a,i){i||(this.getValue()?(e.xmlDeclaration='<?xml version="1.0" encoding="'+(this.getDialog().selectedCharset||"utf-8")+'"?>',n.setAttribute("xmlns","http://www.w3.org/1999/xhtml")):(e.xmlDeclaration="",n.removeAttribute("xmlns")))}}]},{id:"design",label:s.design,elements:[{type:"hbox",widths:["60%","40%"],children:[{type:"vbox",children:[u("txtColor","txtColor",{setup:function(e,t,n,o){this.setValue(o.getComputedStyle("color"))},commit:function(e,t,n,o,a){(this.isChanged()||a)&&(o.removeAttribute("text"),(e=this.getValue())?o.setStyle("color",e):o.removeStyle("color"))}}),u("bgColor","bgColor",{setup:function(e,t,n,o){e=o.getComputedStyle("background-color")||"",this.setValue("transparent"==e?"":e)},commit:function(e,t,n,o,a){(this.isChanged()||a)&&(o.removeAttribute("bgcolor"),(e=this.getValue())?o.setStyle("background-color",e):r(o,"background-color","transparent"))}}),{type:"hbox",widths:["60%","40%"],padding:1,children:[{type:"text",id:"bgImage",label:s.bgImage,setup:function(e,t,n,o){e=o.getComputedStyle("background-image")||"",e="none"==e?"":e.replace(/url\(\s*(["']?)\s*([^\)]*)\s*\1\s*\)/i,function(e,t,n){return n}),this.setValue(e)},commit:function(e,t,n,o){o.removeAttribute("background"),(e=this.getValue())?o.setStyle("background-image","url("+e+")"):r(o,"background-image","none")}},{type:"button",id:"bgImageChoose",label:l.browseServer,style:"display:inline-block;margin-top:10px;",hidden:!0,filebrowser:"design:bgImage"}]},{type:"checkbox",id:"bgFixed",label:s.bgFixed,setup:function(e,t,n,o){this.setValue("fixed"==o.getComputedStyle("background-attachment"))},commit:function(e,t,n,o){this.getValue()?o.setStyle("background-attachment","fixed"):r(o,"background-attachment","scroll")}}]},{type:"vbox",children:[{type:"html",id:"marginTitle",html:'<div style="text-align: center; margin: 0px auto; font-weight: bold">'+s.margin+"</div>"},{type:"text",id:"marginTop",label:s.marginTop,style:"width: 80px; text-align: center",align:"center",inputStyle:"text-align: center",setup:function(e,t,n,o){this.setValue(o.getStyle("margin-top")||o.getAttribute("margintop")||"")},commit:i("top")},{type:"hbox",children:[{type:"text",id:"marginLeft",label:s.marginLeft,style:"width: 80px; text-align: center",align:"center",inputStyle:"text-align: center",setup:function(e,t,n,o){this.setValue(o.getStyle("margin-left")||o.getAttribute("marginleft")||"")},commit:i("left")},{type:"text",id:"marginRight",label:s.marginRight,style:"width: 80px; text-align: center",align:"center",inputStyle:"text-align: center",setup:function(e,t,n,o){this.setValue(o.getStyle("margin-right")||o.getAttribute("marginright")||"")},commit:i("right")}]},{type:"text",id:"marginBottom",label:s.marginBottom,style:"width: 80px; text-align: center",align:"center",inputStyle:"text-align: center",setup:function(e,t,n,o){this.setValue(o.getStyle("margin-bottom")||o.getAttribute("marginbottom")||"")},commit:i("bottom")}]}]}]},{id:"meta",label:s.meta,elements:[{type:"textarea",id:"metaKeywords",label:s.metaKeywords,setup:a("keywords"),commit:o("keywords")},{type:"textarea",id:"metaDescription",label:s.metaDescription,setup:a("description"),commit:o("description")},{type:"text",id:"metaAuthor",label:s.metaAuthor,setup:a("author"),commit:o("author")},{type:"text",id:"metaCopyright",label:s.metaCopyright,setup:a("copyright"),commit:o("copyright")}]},{id:"preview",label:l.preview,elements:[{type:"html",id:"previewHtml",html:'<iframe src="'+d+'" style="width: 100%; height: 310px" hidefocus="true" frameborder="0"></iframe>',onLoad:function(){var e=this.getElement();this.getDialog().on("selectPage",function(t){if("preview"==t.data.page){var n=this;setTimeout(function(){var t=e.getFrameDocument(),o=t.getElementsByTag("html").getItem(0),a=t.getHead(),i=t.getBody();n.commitContent(t,o,a,i,1)},50)}}),e.getAscendant("table").setStyle("height","100%")}}]}]}});