!function(t){if("undefined"==typeof t)throw Error("jQuery should be loaded before CKEditor jQuery adapter.");if("undefined"==typeof CKEDITOR)throw Error("CKEditor should be loaded before CKEditor jQuery adapter.");CKEDITOR.config.jqueryOverrideVal="undefined"==typeof CKEDITOR.config.jqueryOverrideVal||CKEDITOR.config.jqueryOverrideVal,t.extend(t.fn,{ckeditorGet:function(){var t=this.eq(0).data("ckeditorInstance");if(!t)throw"CKEditor is not initialized yet, use ckeditor() with a callback.";return t},ckeditor:function(e,n){if(!CKEDITOR.env.isCompatible)throw Error("The environment is incompatible.");if(!t.isFunction(e)){var r=n;n=e,e=r}var i=[];n=n||{},this.each(function(){var r=t(this),o=r.data("ckeditorInstance"),a=r.data("_ckeditorInstanceLock"),s=this,u=new t.Deferred;i.push(u.promise()),o&&!a?(e&&e.apply(o,[this]),u.resolve()):a?o.once("instanceReady",function(){setTimeout(function(){o.element?(o.element.$==s&&e&&e.apply(o,[s]),u.resolve()):setTimeout(arguments.callee,100)},0)},null,null,9999):((n.autoUpdateElement||"undefined"==typeof n.autoUpdateElement&&CKEDITOR.config.autoUpdateElement)&&(n.autoUpdateElementJquery=!0),n.autoUpdateElement=!1,r.data("_ckeditorInstanceLock",!0),o=t(this).is("textarea")?CKEDITOR.replace(s,n):CKEDITOR.inline(s,n),r.data("ckeditorInstance",o),o.on("instanceReady",function(n){var i=n.editor;setTimeout(function(){if(i.element){if(n.removeListener(),i.on("dataReady",function(){r.trigger("dataReady.ckeditor",[i])}),i.on("setData",function(t){r.trigger("setData.ckeditor",[i,t.data])}),i.on("getData",function(t){r.trigger("getData.ckeditor",[i,t.data])},999),i.on("destroy",function(){r.trigger("destroy.ckeditor",[i])}),i.on("save",function(){return t(s.form).submit(),!1},null,null,20),i.config.autoUpdateElementJquery&&r.is("textarea")&&t(s.form).length){var o=function(){r.ckeditor(function(){i.updateElement()})};t(s.form).submit(o),t(s.form).bind("form-pre-serialize",o),r.bind("destroy.ckeditor",function(){t(s.form).unbind("submit",o),t(s.form).unbind("form-pre-serialize",o)})}i.on("destroy",function(){r.removeData("ckeditorInstance")}),r.removeData("_ckeditorInstanceLock"),r.trigger("instanceReady.ckeditor",[i]),e&&e.apply(i,[s]),u.resolve()}else setTimeout(arguments.callee,100)},0)},null,null,9999))});var o=new t.Deferred;return this.promise=o.promise(),t.when.apply(this,i).then(function(){o.resolve()}),this.editor=this.eq(0).data("ckeditorInstance"),this}}),CKEDITOR.config.jqueryOverrideVal&&(t.fn.val=CKEDITOR.tools.override(t.fn.val,function(e){return function(n){if(arguments.length){var r=this,i=[],o=this.each(function(){var r=t(this),o=r.data("ckeditorInstance");if(r.is("textarea")&&o){var a=new t.Deferred;return o.setData(n,function(){a.resolve()}),i.push(a.promise()),!0}return e.call(r,n)});if(i.length){var a=new t.Deferred;return t.when.apply(this,i).done(function(){a.resolveWith(r)}),a.promise()}return o}var o=t(this).eq(0),s=o.data("ckeditorInstance");return o.is("textarea")&&s?s.getData():e.call(o)}}))}(window.jQuery);